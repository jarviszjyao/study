# Session Model Specification

## 1. What is a Session

A session represents a continuous conversation between a user and the Cloud Query Assistant.

A session contains:

- User identity
- Conversation history
- Current resolved intent
- Clarification state
- Context memory
- Generated query spec history

Session is NOT equal to a browser connection.

A session survives:
- page refresh
- temporary network loss
- async responses

---

## 2. Session Lifecycle

CREATE
  ↓
ACTIVE (multi-turn conversation)
  ↓
CLARIFICATION LOOP (optional)
  ↓
QUERY EXECUTION
  ↓
RESULT DELIVERY
  ↓
IDLE
  ↓
EXPIRE (TTL reached)

---

## 3. Session ID

Generated by frontend:

session_id = UUIDv7()

Sent on every request:

POST /chat
headers:
  x-session-id

---

## 4. Storage (DynamoDB)

Table: chat_sessions

Partition Key:
  session_id

Attributes:

{
  session_id: string,
  user_id: string,
  created_at: timestamp,
  last_active_at: timestamp,

  conversation_history: [],
  current_intent: {},
  clarification_state: {},
  context_memory: {},

  query_history: [],
  ttl: epoch_seconds
}

TTL recommended:
- 24 hours (demo)
- 7 days (production)

---

## 5. Conversation History Format

[
  {
    "role": "user",
    "content": "show accounts under payments"
  },
  {
    "role": "assistant",
    "content": "Do you mean Payments Platform or Payment Gateway?"
  }
]

Only last N turns are sent to LLM (context window control).

---

## 6. Session Responsibilities

Session enables:

- multi-turn reasoning
- ambiguity resolution
- intent refinement
- contextual follow-up queries

Example:

User: show risky accounts
Assistant: which department?
User: payments

Second message relies on session memory.